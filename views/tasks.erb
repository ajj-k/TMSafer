<a href="/home">戻る</a></br>
<a href='/school/<%= @school_id %>/del'>このスクールを削除する</a></br>

<!--
<form action="/check" method="post">
    <input type="text" name="tms" placeholder="TMSのURLを貼ってください">
    <input type="submit" value="送信">
</form></br>
-->
<div class="mx-auto" style="width: 600px;">
    
<div style="font-family: 'M PLUS 1', sans-serif;">
<form action="/check" method="post">
    <h1 style="font-weight: bold;">メンバー一覧 <input type="submit" class="btn btn-secondary"value="TMS更新"></h1>
    <input type="hidden" name="school" value="<%= @school_id %>">
</form></br>

<% current_user.schools.find(@school_id).members.each do |member| %>
<div class="mx-auto" style="width: 600px;">
    <% if member.icon != "" %>
    <h2><%= member.name %> <img src="<%= member.icon %>" width="60" height="60">
        <button type="button" class="btn btn-link" data-bs-toggle="modal" data-bs-target="#DeleteModal" data-bs-delete="<%= member.id %>">
            削除
        </button>
    </h2>
    <% else %>
    <h2><%= member.name %> <img src="/assets/image/programming.png" width="60" height="60">
        <button type="button" class="btn btn-link" data-bs-toggle="modal" data-bs-target="#DeleteModal" data-bs-delete="<%= member.id %>">
            削除
        </button>
    </h2>
    <% end %>
    <div class="container">
    <div class="row row-col-6">
        
    <% danger_task = [] %>
    <% warning_task = [] %>
    <% safety_task = [] %>
    <% some_task = [] %>
    
    <% member.tasks.each do |task| %>
        <% begin %>
            <% if date_check(task.date) == 2 %>
                <% danger_task.push(task) %>
            <% elsif date_check(task.date) == 1 %>
                <% warning_task.push(task) %>
            <% else %>
                <% safety_task.push(task) %>
            <% end %>
        <% rescue %>
                <% some_task.push(task) %>
        <% end %>
    <% end %>
    
    <% safety_task.each do |task| %>
        <div class="col task">
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#ContentModal" data-bs-content="<%= task.content %>" data-bs-date="<%= task.date %>" data-bs-importance="<%= task.importance %>" style="margin: 1em;">&nbsp;&nbsp;&nbsp;</button>
            <input type="hidden" class="tms" value="<%= task.id %>">
        </div>
    <% end %>
        
    <% warning_task.each do |task| %>
        <div class="col task">
            <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#ContentModal" data-bs-content="<%= task.content %>" data-bs-date="<%= task.date %>" data-bs-importance="<%= task.importance %>" style="margin: 1em;">&nbsp;&nbsp;&nbsp;</button>
            <input type="hidden" class="tms" value="<%= task.id%>">
        </div>
    <% end %>
    
    <% danger_task.each do |task| %>
        <div class="col task">
            <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#ContentModal" data-bs-content="<%= task.content %>" data-bs-date="<%= task.date %>" data-bs-importance="<%= task.importance %>" style="margin: 1em;">&nbsp;&nbsp;&nbsp;</button>
            <input type="hidden" class="tms" value="<%= task.id%>">
        </div>
    <% end %>
    
    <% some_task.each do |task| %>
        <div class="col task">
            <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#ContentModal" data-bs-content="<%= task.content %>" data-bs-date="<%= task.date %>" data-bs-importance="<%= task.importance %>" style="margin: 1em;">&nbsp;&nbsp;&nbsp;</button>
            <input type="hidden" class="tms" value="<%= task.id %>">
        </div>
    <% end %>
    
    </div>
    </div>

    </div> <!-- col -->

<% end %>


<button type="button" class="btn btn-primary mx-auto" style="width: 200px; margin-top: 20px;" data-bs-toggle="modal" data-bs-target="#exampleModal">
    新規メンバー登録
</button>
</div>

<!-- メンバー登録用モーダル -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">新規メンバー登録</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>メンバー登録</p>
                <form action="/school/<%= @school_id %>/members/add" method="post" enctype="multipart/form-data">
                    <input type="text" name="name" placeholder="ニックネームを入力してください"></br>
                    <!--<input type="text" name="cource" placeholder="コース名を入力してください">-->
                    <input type="text" name="url" placeholder="TMSのURLを入力してください"></br>
                    <input type="file" name="icon"></br>
                    <input type="submit" value="登録">
                </form>
            </div>
        </div>
    </div>
</div>

<!-- タスク表示用モーダル -->
<div class="modal fade" id="ContentModal" tabindex="-1" role="dialog" aria-labelledby="ContentModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ContentModalLabel">TMS情報</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="tms">
                <div class="content"></div></br>
                <div class="date"></div></br>
                <div class="importance"></div></br>
            </div>
        </div>
    </div>
</div>

<!-- メンバー削除モーダル -->
<div class="modal fade" id="DeleteModal" tabindex="-1" aria-labelledby="DeleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="DeleteModalLabel">警告</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        本当に削除しますか？
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">閉じる</button>
        <form action="/school/members/del" method="post" id="tms_delete">
            <button type="submit" class="btn btn-primary">削除</button>
            <input type="hidden" name="id" class="delete" value="">
            <input type="hidden" name="school" value="<%= @school_id %>">
        </form>
      </div>
    </div>
  </div>
</div>



</div>
</div>
</div>

<script>
    var Modal = document.getElementById('ContentModal');
    Modal.addEventListener('show.bs.modal', function(event) {
        var button = event.relatedTarget;
        var recipient_Content = button.getAttribute('data-bs-content');
        var recipient_Date = button.getAttribute('data-bs-date');
        var recipient_importance = button.getAttribute('data-bs-importance');
        
        if (recipient_importance == "3") {
            recipient_importance = "★★★"
        } else if (recipient_importance == "2") {
            recipient_importance = "☆★★"
        } else if (recipient_importance == "1") {
            recipient_importance = "☆☆★"
        } else {
            recipient_importance = "others"
        }
        
        $("#tms .content").text(recipient_Content);
        $("#tms .date").text(recipient_Date);
        $("#tms .importance").text(recipient_importance);
        console.log("呼ばれました")
    });
    
    var delete_modal = document.getElementById('DeleteModal');
    delete_modal.addEventListener('show.bs.modal', function(event) {
        var button = event.relatedTarget;
        var recipient_member = button.getAttribute('data-bs-delete');
        
        $("#tms_delete .delete").val(recipient_member);
        console.log(recipient_member)
    })
</script>
